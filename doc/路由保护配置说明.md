# è·¯ç”±ä¿æŠ¤é…ç½®è¯´æ˜

æœ¬é¡¹ç›®æä¾›äº†ä¸‰ç§æ–¹å¼æ¥ç®¡ç†è·¯ç”±ä¿æŠ¤å’Œè®¤è¯ã€‚

---

## ğŸ“ ç›¸å…³æ–‡ä»¶

### 1. **è·¯ç”±é…ç½®æ–‡ä»¶** `src/config/routes.js`
é›†ä¸­ç®¡ç†æ‰€æœ‰è·¯ç”±çš„è®¿é—®æƒé™é…ç½®ã€‚

```javascript
// å…¬å¼€è·¯ç”±ï¼ˆä¸éœ€è¦ç™»å½•ï¼‰
export const PUBLIC_ROUTES = [
  '/',
  '/components/login',
  '/components/register',
];

// å—ä¿æŠ¤çš„è·¯ç”±ï¼ˆéœ€è¦ç™»å½•ï¼‰
export const PROTECTED_ROUTES = [
  '/components/home',
  '/components/profile',
];

// å…¬å¼€ API è·¯ç”±ï¼ˆä¸éœ€è¦ Tokenï¼‰
export const PUBLIC_API_ROUTES = [
  '/api/auth/login',
  '/api/auth/register',
];
```

### 2. **ä¸­é—´ä»¶** `src/middleware.js`
Next.js ä¸­é—´ä»¶ï¼Œç”¨äºè·¯ç”±çº§åˆ«çš„ä¿æŠ¤ï¼ˆç›®å‰ä¸»è¦ç”¨äºå®šä¹‰é…ç½®ï¼‰ã€‚

### 3. **AuthGuard ç»„ä»¶** `src/components/auth/AuthGuard.jsx`
ç”¨äºåŒ…è£…éœ€è¦ä¿æŠ¤çš„é¡µé¢ç»„ä»¶ã€‚

---

## ğŸ›¡ï¸ å¦‚ä½•ä¿æŠ¤æ–°é¡µé¢

### æ–¹æ³• 1ï¼šä½¿ç”¨ AuthGuard ç»„ä»¶ï¼ˆæ¨èï¼‰

```jsx
'use client';

import AuthGuard from '@/components/auth/AuthGuard';
import AppLayout from '@/components/layout/AppLayout';

export default function ProtectedPage() {
  return (
    <AuthGuard>
      <AppLayout>
        {/* ä½ çš„é¡µé¢å†…å®¹ */}
      </AppLayout>
    </AuthGuard>
  );
}
```

### æ–¹æ³• 2ï¼šæ‰‹åŠ¨æ£€æŸ¥ï¼ˆçµæ´»åº¦é«˜ï¼‰

```jsx
'use client';

import { useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { useAuth } from '@/contexts/AuthContext';

export default function ProtectedPage() {
  const { isAuthenticated, loading } = useAuth();
  const router = useRouter();

  useEffect(() => {
    if (!loading && !isAuthenticated) {
      router.push('/components/login');
    }
  }, [loading, isAuthenticated, router]);

  if (loading || !isAuthenticated) {
    return <div>åŠ è½½ä¸­...</div>;
  }

  return <div>å—ä¿æŠ¤çš„å†…å®¹</div>;
}
```

---

## â• æ·»åŠ å…¬å¼€è·¯ç”±

å¦‚æœè¦æ·»åŠ ä¸éœ€è¦ç™»å½•çš„å…¬å¼€é¡µé¢ï¼š

### æ­¥éª¤ 1ï¼šåœ¨ `src/config/routes.js` ä¸­æ·»åŠ è·¯ç”±

```javascript
export const PUBLIC_ROUTES = [
  '/',
  '/components/login',
  '/components/register',
  '/components/about',        // â† æ–°å¢å…¬å¼€é¡µé¢
  '/components/help',          // â† æ–°å¢å…¬å¼€é¡µé¢
];
```

### æ­¥éª¤ 2ï¼šåˆ›å»ºé¡µé¢æ—¶ä¸ä½¿ç”¨ AuthGuard

```jsx
// src/app/components/about/page.jsx
export default function AboutPage() {
  return <div>è¿™æ˜¯å…¬å¼€é¡µé¢ï¼Œæ— éœ€ç™»å½•</div>;
}
```

---

## ğŸ”’ æ·»åŠ å—ä¿æŠ¤è·¯ç”±

### æ­¥éª¤ 1ï¼šåœ¨ `src/config/routes.js` ä¸­æ·»åŠ è·¯ç”±

```javascript
export const PROTECTED_ROUTES = [
  '/components/home',
  '/components/profile',
  '/components/dashboard',     // â† æ–°å¢å—ä¿æŠ¤é¡µé¢
];
```

### æ­¥éª¤ 2ï¼šä½¿ç”¨ AuthGuard åŒ…è£…é¡µé¢

```jsx
// src/app/components/dashboard/page.jsx
import AuthGuard from '@/components/auth/AuthGuard';
import AppLayout from '@/components/layout/AppLayout';

export default function DashboardPage() {
  return (
    <AuthGuard>
      <AppLayout>
        <div>è¿™æ˜¯å—ä¿æŠ¤çš„é¡µé¢</div>
      </AppLayout>
    </AuthGuard>
  );
}
```

---

## ğŸŒ API è·¯ç”±ä¿æŠ¤

### å…¬å¼€ APIï¼ˆä¸éœ€è¦ Tokenï¼‰

åœ¨ `src/config/routes.js` ä¸­æ·»åŠ ï¼š

```javascript
export const PUBLIC_API_ROUTES = [
  '/api/auth/login',
  '/api/auth/register',
  '/api/auth/refresh',
  '/api/public/data',          // â† æ–°å¢å…¬å¼€ API
];
```

### å—ä¿æŠ¤çš„ APIï¼ˆéœ€è¦ Tokenï¼‰

æ‰€æœ‰ä¸åœ¨ `PUBLIC_API_ROUTES` ä¸­çš„ API éƒ½éœ€è¦ Token éªŒè¯ã€‚

åœ¨ API è·¯ç”±ä¸­éªŒè¯ Tokenï¼š

```javascript
// src/app/api/protected/route.js
import { verifyAccessToken } from '@/lib/jwt';

export async function GET(request) {
  const token = request.headers.get('Authorization')?.substring(7);
  const decoded = verifyAccessToken(token);

  if (!decoded) {
    return NextResponse.json(
      { message: 'æœªæˆæƒ' },
      { status: 401 }
    );
  }

  // å¤„ç†è¯·æ±‚...
}
```

---

## ğŸ“ å½“å‰è·¯ç”±é…ç½®

### å…¬å¼€è·¯ç”±
- `/` - é¦–é¡µ
- `/components/login` - ç™»å½•é¡µ
- `/components/register` - æ³¨å†Œé¡µ

### å—ä¿æŠ¤è·¯ç”±
- `/components/home` - ç”¨æˆ·é¦–é¡µ
- `/components/profile` - ä¸ªäººèµ„æ–™
- `/components/settings` - è®¾ç½®
- `/components/docs` - æ–‡æ¡£

### å…¬å¼€ API
- `/api/auth/login` - ç™»å½•æ¥å£
- `/api/auth/register` - æ³¨å†Œæ¥å£
- `/api/auth/refresh` - Token åˆ·æ–°æ¥å£

### å—ä¿æŠ¤çš„ API
- `/api/user/profile` - ç”¨æˆ·ä¿¡æ¯æ¥å£ï¼ˆéœ€è¦ Tokenï¼‰
- `/api/auth/logout` - ç™»å‡ºæ¥å£ï¼ˆéœ€è¦ Tokenï¼‰

---

## ğŸ”„ é‡å®šå‘é…ç½®

åœ¨ `src/config/routes.js` ä¸­é…ç½®é»˜è®¤é‡å®šå‘ï¼š

```javascript
export const DEFAULT_LOGIN_REDIRECT = '/components/home';  // ç™»å½•æˆåŠŸåè·³è½¬
export const DEFAULT_LOGOUT_REDIRECT = '/components/login'; // ç™»å‡ºåè·³è½¬
```

---

## âš™ï¸ AuthGuard è‡ªå®šä¹‰é‡å®šå‘

AuthGuard æ”¯æŒè‡ªå®šä¹‰é‡å®šå‘è·¯å¾„ï¼š

```jsx
<AuthGuard redirectTo="/components/custom-login">
  <YourContent />
</AuthGuard>
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

1. **é›†ä¸­ç®¡ç†** - æ‰€æœ‰è·¯ç”±é…ç½®éƒ½åœ¨ `src/config/routes.js` ä¸­
2. **ä¼˜å…ˆä½¿ç”¨ AuthGuard** - ä½¿ç”¨ AuthGuard ç»„ä»¶åŒ…è£…é¡µé¢ï¼Œä»£ç æ›´ç®€æ´
3. **ä¿æŒä¸€è‡´** - æ–°å¢è·¯ç”±æ—¶è®°å¾—æ›´æ–°é…ç½®æ–‡ä»¶
4. **API ä¿æŠ¤** - æ•æ„Ÿ API å¿…é¡»åœ¨è·¯ç”±ä¸­éªŒè¯ Token
5. **å‰åç«¯åŒé‡éªŒè¯** - å‰ç«¯è·¯ç”±ä¿æŠ¤åªæ˜¯ UX ä¼˜åŒ–ï¼ŒçœŸæ­£çš„å®‰å…¨éªŒè¯åœ¨åç«¯ API

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

1. åˆ›å»ºæ–°çš„å—ä¿æŠ¤é¡µé¢ï¼š
   ```bash
   # åœ¨ src/app/components/yourpage/ åˆ›å»º page.jsx
   ```

2. ä½¿ç”¨ AuthGuard åŒ…è£…ï¼š
   ```jsx
   import AuthGuard from '@/components/auth/AuthGuard';

   export default function YourPage() {
     return <AuthGuard>...</AuthGuard>;
   }
   ```

3. åœ¨ routes.js ä¸­æ³¨å†Œï¼ˆå¯é€‰ï¼Œç”¨äºæ–‡æ¡£è®°å½•ï¼‰ï¼š
   ```javascript
   export const PROTECTED_ROUTES = [
     // ...
     '/components/yourpage',
   ];
   ```

å®Œæˆï¼ä½ çš„æ–°é¡µé¢ç°åœ¨å·²ç»å—åˆ°ä¿æŠ¤äº†ã€‚
